name: Deploy Flask Portfolio

# Déclenche le workflow à chaque push sur main
on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Récupérer le code du dépôt
    - name: Checkout code
      uses: actions/checkout@v3

    # 2️⃣ Ajouter la clé SSH
    - name: Set up SSH
      uses: webfactory/ssh-agent@v0.9.1
      with:
        ssh-private-key: ${{ secrets.SSH_KEY }}

    # 3️⃣ Déployer sur le serveur
    - name: Deploy to server
      run: |
        ssh user@IP_DU_SERVEUR "
          cd /chemin/vers/le/projet &&    # remplacer par le chemin réel sur le serveur
          git pull &&
          source venv/bin/activate &&     # ou venv\Scripts\activate sur Windows
          pip install -r requirements.txt &&
          systemctl restart flask_app.service   # ou la commande pour redémarrer ton app Flask
        "
